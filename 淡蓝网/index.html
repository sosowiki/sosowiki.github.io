<!DOCTYPE html>
<html  lang="zh">
<head>
    <meta charset="utf-8" />

<meta name="generator" content="Hexo 3.8.0" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>淡蓝网 - SOSOWIKI</title>


    <meta name="description" content="淡蓝网">
<meta name="keywords" content="面试,淡蓝网">
<meta property="og:type" content="article">
<meta property="og:title" content="淡蓝网">
<meta property="og:url" content="http://soso.wiki/淡蓝网/index.html">
<meta property="og:site_name" content="SOSOWIKI">
<meta property="og:description" content="淡蓝网">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://soso.wiki/images/og_image.png">
<meta property="og:updated_time" content="2024-07-29T07:59:35.221Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="淡蓝网">
<meta name="twitter:description" content="淡蓝网">
<meta name="twitter:image" content="http://soso.wiki/images/og_image.png">







<link rel="icon" href="/images/favicon.jpeg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-dark.css">


    
    
    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">


    
    
    
    

<link rel="stylesheet" href="/css/back-to-top.css">


    
    

    
    
<script>
var _hmt = _hmt || [];
(function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?b07e5a4ee78cf8302e7e2cf5b9db7f2c";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
})();
</script>

    
    

    
    
<link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

    
    
    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-1-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo-2.png" alt="淡蓝网" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">首页</a>
                
                <a class="navbar-item"
                href="/archives">归档</a>
                
                <a class="navbar-item"
                href="/tags">标签</a>
                
                <a class="navbar-item"
                href="/about">关于</a>
                
            </div>
            
            <div class="navbar-end">
                
                
                
                <a class="navbar-item search" title="搜索" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-12 has-order-2 column-main"><div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2024-07-29T03:00:00.000Z">2024-07-29</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/面试题/">面试题</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    19 分钟 读完 (大约 2856 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                淡蓝网
            
        </h1>
        <div class="content">
            <p>淡蓝网<br><a id="more"></a></p>
<p>1.SDK体积优化，无用代码检测怎么做的？</p>
<p>2.加载速度优化，怎么发现的多次刷新？</p>
<p>3.高考项目</p>
<p>4.循环引用怎么解决？NSTimer 为什么用 weak 不能解决循环引用</p>
<p>5.Swift 中 weak 和 unowned 的区别？什么场景下用 unowned？或者说 unowned 有什么好处？</p>
<p>6.什么场景下用分类？Category 能添加属性吗？为什么不能添加成员变量？苹果为什么这么设计？</p>
<p>7.为什么要设计元类？</p>
<p>8.SDK中有个类有私有成员变量，怎么改它的值？</p>
<p>9.数组的方法被 hook 了，怎么让有些数组不生效，使用系统的默认方法</p>
<h2 id="参考答案"><a href="#参考答案" class="headerlink" title="参考答案"></a>参考答案</h2><p>1.SDK体积优化，无用代码检测怎么做的？</p>
<p>通过使用<strong>otool</strong>工具对编译产生的<strong>Mach-O</strong>文件，结合项目源码进行分析。</p>
<p><strong>第一步：</strong><br> 找到项目中所有的<code>protocol</code>中的方法&lt;包括系统<code>&lt;UITabaleViewDelegate&gt;</code>的和项目的&gt;</p>
<p><strong>第二步：</strong><br> 通过<strong>Mach-O</strong>，找到项目中所有被引用的方法</p>
<p><strong>第三步：</strong><br> 通过<strong>Mach-O</strong>，找到项目中所有的方法</p>
<p><strong>第四步：</strong><br> 遍历第三步查出的所有方法，如果当前方法不在代理方法集合，也不在引用方法集合中，那么就认为是没有用到的方法。</p>
<p>参考链接：<a href="https://www.jianshu.com/p/d62db6c082e9" target="_blank" rel="noopener">简书-iOS 脚本查看项目未使用到的方法</a></p>
<p>2.加载速度优化，怎么发现的多次刷新</p>
<p>3.高考项目</p>
<p>4.循环引用怎么解决？NSTimer为什么用weak不能解决循环引用</p>
<h3 id="解决循环引用的方法"><a href="#解决循环引用的方法" class="headerlink" title="解决循环引用的方法"></a>解决循环引用的方法</h3><h4 id="1-使用-weak-修饰符"><a href="#1-使用-weak-修饰符" class="headerlink" title="1. 使用 weak 修饰符"></a>1. 使用 <code>weak</code> 修饰符</h4><p>在使用闭包时，可以使用<code>weak</code>或<code>unowned</code>关键字来解决循环引用问题。</p>
<figure class="highlight objc hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">__<span class="hljs-keyword">weak</span> <span class="hljs-keyword">typeof</span>(<span class="hljs-keyword">self</span>) weakSelf = <span class="hljs-keyword">self</span>;</span><br><span class="line"><span class="hljs-keyword">self</span>.someBlock = ^&#123;</span><br><span class="line">    [weakSelf doSomething];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>在Swift中：</p>
<figure class="highlight swift hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> weakSelf = <span class="hljs-keyword">self</span></span><br><span class="line"><span class="hljs-keyword">self</span>.someBlock = &#123; [<span class="hljs-keyword">weak</span> weakSelf] <span class="hljs-keyword">in</span></span><br><span class="line">    weakSelf?.doSomething()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-使用-delegate-和-weak-修饰符"><a href="#2-使用-delegate-和-weak-修饰符" class="headerlink" title="2. 使用 delegate 和 weak 修饰符"></a>2. 使用 <code>delegate</code> 和 <code>weak</code> 修饰符</h4><p>在使用委托模式时，可以将委托声明为<code>weak</code>。</p>
<figure class="highlight objc hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">weak</span>) <span class="hljs-keyword">id</span>&lt;MyDelegate&gt; delegate;</span><br></pre></td></tr></table></figure>
<p>在Swift中：</p>
<figure class="highlight swift hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> delegate: <span class="hljs-type">MyDelegate</span>?</span><br></pre></td></tr></table></figure>
<h4 id="3-使用-block-修饰符"><a href="#3-使用-block-修饰符" class="headerlink" title="3. 使用 __block 修饰符"></a>3. 使用 <code>__block</code> 修饰符</h4><p>在某些情况下，可以使用<code>__block</code>修饰符来解决循环引用问题。</p>
<figure class="highlight objc hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">__block <span class="hljs-keyword">typeof</span>(<span class="hljs-keyword">self</span>) blockSelf = <span class="hljs-keyword">self</span>;</span><br><span class="line"><span class="hljs-keyword">self</span>.someBlock = ^&#123;</span><br><span class="line">    [blockSelf doSomething];</span><br><span class="line">    blockSelf = <span class="hljs-literal">nil</span>; <span class="hljs-comment">// 解除循环引用</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="为什么-NSTimer-使用-weak-不能解决循环引用"><a href="#为什么-NSTimer-使用-weak-不能解决循环引用" class="headerlink" title="为什么 NSTimer 使用 weak 不能解决循环引用"></a>为什么 <code>NSTimer</code> 使用 <code>weak</code> 不能解决循环引用</h3><p><code>NSTimer</code> 是一个常见的导致循环引用的源头，因为它会强引用其目标对象。即使你在目标对象中使用<code>weak</code>修饰符，<code>NSTimer</code>仍然会强引用目标对象，导致循环引用。</p>
<h4 id="使用-NSTimer-的正确方法"><a href="#使用-NSTimer-的正确方法" class="headerlink" title="使用 NSTimer 的正确方法"></a>使用 <code>NSTimer</code> 的正确方法</h4><ol>
<li><strong>使用中介对象</strong></li>
</ol>
<p>你可以创建一个中介对象，这个对象不会强引用目标对象，从而打破循环引用。</p>
<figure class="highlight objc hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">TimerProxy</span> : <span class="hljs-title">NSObject</span></span></span><br><span class="line"><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">weak</span>) <span class="hljs-keyword">id</span> target;</span><br><span class="line"><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>) SEL selector;</span><br><span class="line"><span class="hljs-keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">TimerProxy</span></span></span><br><span class="line">- (<span class="hljs-keyword">void</span>)timerDidFire:(<span class="hljs-built_in">NSTimer</span> *)timer &#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.target) &#123;</span><br><span class="line">        [<span class="hljs-keyword">self</span>.target performSelector:<span class="hljs-keyword">self</span>.selector withObject:timer];</span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">        [timer invalidate];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 使用中介对象</span></span><br><span class="line">TimerProxy *proxy = [TimerProxy new];</span><br><span class="line">proxy.target = <span class="hljs-keyword">self</span>;</span><br><span class="line">proxy.selector = <span class="hljs-keyword">@selector</span>(timerDidFire:);</span><br><span class="line"></span><br><span class="line"><span class="hljs-built_in">NSTimer</span> *timer = [<span class="hljs-built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="hljs-number">1.0</span></span><br><span class="line">                                                  target:proxy</span><br><span class="line">                                                selector:<span class="hljs-keyword">@selector</span>(timerDidFire:)</span><br><span class="line">                                                userInfo:<span class="hljs-literal">nil</span></span><br><span class="line">                                                 repeats:<span class="hljs-literal">YES</span>];</span><br></pre></td></tr></table></figure>
<ol>
<li><strong>使用 <code>GCD</code> 定时器</strong></li>
</ol>
<p><code>GCD</code> 提供了一种无需手动管理循环引用的定时器。</p>
<figure class="highlight objc hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-built_in">dispatch_queue_t</span> queue = dispatch_get_main_queue();</span><br><span class="line"><span class="hljs-keyword">self</span>.timer = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, queue);</span><br><span class="line"></span><br><span class="line">dispatch_source_set_timer(<span class="hljs-keyword">self</span>.timer, dispatch_time(DISPATCH_TIME_NOW, <span class="hljs-number">0</span>), <span class="hljs-number">1.0</span> * <span class="hljs-built_in">NSEC_PER_SEC</span>, (<span class="hljs-number">1</span>ull * <span class="hljs-built_in">NSEC_PER_SEC</span>) / <span class="hljs-number">10</span>);</span><br><span class="line"></span><br><span class="line">__<span class="hljs-keyword">weak</span> <span class="hljs-keyword">typeof</span>(<span class="hljs-keyword">self</span>) weakSelf = <span class="hljs-keyword">self</span>;</span><br><span class="line">dispatch_source_set_event_handler(<span class="hljs-keyword">self</span>.timer, ^&#123;</span><br><span class="line">    [weakSelf timerDidFire];</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">dispatch_resume(<span class="hljs-keyword">self</span>.timer);</span><br></pre></td></tr></table></figure>
<p>在Swift中：</p>
<figure class="highlight swift hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">let</span> queue = <span class="hljs-type">DispatchQueue</span>.main</span><br><span class="line"><span class="hljs-keyword">let</span> timer = <span class="hljs-type">DispatchSource</span>.makeTimerSource(queue: queue)</span><br><span class="line"></span><br><span class="line">timer.schedule(deadline: .now(), repeating: <span class="hljs-number">1.0</span>)</span><br><span class="line"></span><br><span class="line">timer.setEventHandler &#123; [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] <span class="hljs-keyword">in</span></span><br><span class="line">    <span class="hljs-keyword">self</span>?.timerDidFire()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">timer.resume()</span><br><span class="line"><span class="hljs-keyword">self</span>.timer = timer</span><br></pre></td></tr></table></figure>
<p>5.swift中weak和unowned的区别？什么场景下用unowned？或者说unowned有什么好处？</p>
<p>在Swift中，<code>weak</code> 和 <code>unowned</code> 是两种用于解决强引用循环（retain cycle）问题的引用类型修饰符。虽然它们都可以用来打破循环引用，但它们的行为和使用场景有所不同。</p>
<h3 id="weak-和-unowned-的区别"><a href="#weak-和-unowned-的区别" class="headerlink" title="weak 和 unowned 的区别"></a><code>weak</code> 和 <code>unowned</code> 的区别</h3><h4 id="weak"><a href="#weak" class="headerlink" title="weak"></a><code>weak</code></h4><ol>
<li><p><strong>可选类型</strong>：<code>weak</code> 修饰的引用会被自动设置为 <code>nil</code> 当其引用的对象被释放时。因此，<code>weak</code> 引用必须是可选类型（Optional）。</p>
</li>
<li><p><strong>自动解除引用</strong>：使用 <code>weak</code> 修饰符可以防止强引用循环，因为当被引用对象被释放时，<code>weak</code> 引用会自动变成 <code>nil</code>。</p>
</li>
<li><p>用法</p>
<figure class="highlight objc hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">class</span> Person &#123;</span><br><span class="line">    var name: String</span><br><span class="line">    <span class="hljs-keyword">weak</span> var spouse: Person?</span><br><span class="line"></span><br><span class="line">    init(name: String) &#123;</span><br><span class="line">        <span class="hljs-keyword">self</span>.name = name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var john: Person? = Person(name: <span class="hljs-string">"John"</span>)</span><br><span class="line">var jane: Person? = Person(name: <span class="hljs-string">"Jane"</span>)</span><br><span class="line"></span><br><span class="line">john?.spouse = jane</span><br><span class="line">jane?.spouse = john</span><br><span class="line"></span><br><span class="line">john = <span class="hljs-literal">nil</span></span><br><span class="line"><span class="hljs-comment">// At this point, jane?.spouse is automatically set to nil</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="unowned"><a href="#unowned" class="headerlink" title="unowned"></a><code>unowned</code></h4><ol>
<li><p><strong>非可选类型</strong>：<code>unowned</code> 修饰的引用在其引用的对象被释放后不会自动变成 <code>nil</code>，并且它必须是非可选类型（Non-Optional）。</p>
</li>
<li><p><strong>无自动解除引用</strong>：使用 <code>unowned</code> 修饰符不会自动变成 <code>nil</code>，如果你尝试访问一个已经被释放的对象，会导致运行时崩溃。</p>
</li>
<li><p>用法</p>
<figure class="highlight swift hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">var</span> name: <span class="hljs-type">String</span></span><br><span class="line">    <span class="hljs-keyword">var</span> car: <span class="hljs-type">Car</span>?</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">init</span>(name: <span class="hljs-type">String</span>) &#123;</span><br><span class="line">        <span class="hljs-keyword">self</span>.name = name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Car</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">var</span> model: <span class="hljs-type">String</span></span><br><span class="line">    <span class="hljs-keyword">unowned</span> <span class="hljs-keyword">var</span> owner: <span class="hljs-type">Person</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">init</span>(model: <span class="hljs-type">String</span>, owner: <span class="hljs-type">Person</span>) &#123;</span><br><span class="line">        <span class="hljs-keyword">self</span>.model = model</span><br><span class="line">        <span class="hljs-keyword">self</span>.owner = owner</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">var</span> john: <span class="hljs-type">Person</span>? = <span class="hljs-type">Person</span>(name: <span class="hljs-string">"John"</span>)</span><br><span class="line"><span class="hljs-keyword">var</span> johnsCar: <span class="hljs-type">Car</span>? = <span class="hljs-type">Car</span>(model: <span class="hljs-string">"Tesla"</span>, owner: john!)</span><br><span class="line"></span><br><span class="line">john?.car = johnsCar</span><br><span class="line"></span><br><span class="line">john = <span class="hljs-literal">nil</span></span><br><span class="line"><span class="hljs-comment">// At this point, accessing johnsCar?.owner will cause a runtime crash because john has been deallocated</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><h4 id="什么时候使用-weak"><a href="#什么时候使用-weak" class="headerlink" title="什么时候使用 weak"></a>什么时候使用 <code>weak</code></h4><ul>
<li>当引用的对象可能在其生命周期中变为 <code>nil</code> 时。</li>
<li>常见的场景包括委托（delegates）、UI元素的引用（例如：视图控制器对视图的引用），以及任何你预计会变为 <code>nil</code> 的引用。</li>
</ul>
<h4 id="什么时候使用-unowned"><a href="#什么时候使用-unowned" class="headerlink" title="什么时候使用 unowned"></a>什么时候使用 <code>unowned</code></h4><ul>
<li>当引用的对象在其生命周期中不会变为 <code>nil</code>，并且你确定引用的对象会一直存在直到被引用对象的生命周期结束。</li>
<li>常见的场景包括：两个对象具有相同的生命周期，或一个对象的生命周期完全包含另一个对象的生命周期。</li>
<li>例如，闭包对 <code>self</code> 的引用可以使用 <code>unowned</code> 修饰符，因为闭包的生命周期通常与其持有者相同或更短。</li>
</ul>
<h3 id="unowned-的好处"><a href="#unowned-的好处" class="headerlink" title="unowned 的好处"></a><code>unowned</code> 的好处</h3><ul>
<li><strong>性能</strong>：由于 <code>unowned</code> 引用不会自动设置为 <code>nil</code>，它的性能稍微优于 <code>weak</code> 引用，因为不需要额外的nil检查。</li>
<li><strong>非可选类型</strong>：<code>unowned</code> 引用不需要解包，因为它是非可选类型，这可以简化代码。</li>
</ul>
<p>然而，使用 <code>unowned</code> 引用时需要非常小心，因为如果引用的对象被释放后再访问该引用，会导致运行时崩溃。一般来说，除非你非常确定引用的对象在其生命周期中不会变为 <code>nil</code>，否则建议使用 <code>weak</code> 引用。</p>
<p>6.什么场景下用分类？Category能添加属性吗？为什么不能添加成员变量？苹果为什么这么设计？</p>
<p>在 Objective-C 中，<code>Category</code> 是用于为现有类添加方法的一种机制，但它不能直接添加成员变量（实例变量）。不过，可以通过一些间接方式为 <code>Category</code> 添加属性。让我们深入探讨一下为什么 <code>Category</code> 不能添加成员变量、苹果为什么设计成这样，以及如何在 <code>Category</code> 中添加属性。</p>
<h3 id="为什么-Category-不能添加成员变量"><a href="#为什么-Category-不能添加成员变量" class="headerlink" title="为什么 Category 不能添加成员变量"></a>为什么 <code>Category</code> 不能添加成员变量</h3><p><code>Category</code> 主要设计目的是为了扩展已有类的功能，而不是修改类的内部结构。添加成员变量会涉及到修改类的内存布局，这在运行时会带来很多复杂性和潜在的问题。</p>
<ol>
<li><strong>内存布局问题</strong>：Objective-C 的内存布局是在编译时确定的，而成员变量会影响对象的内存布局。如果允许在 <code>Category</code> 中添加成员变量，那么就意味着当一个新 <code>Category</code> 被加载时，需要重新计算和调整所有实例的内存布局，这在运行时是非常复杂和低效的。</li>
<li><strong>二进制兼容性</strong>：允许 <code>Category</code> 添加成员变量会破坏二进制兼容性。假设一个类库在某个版本中添加了一个包含成员变量的 <code>Category</code>，而在早期版本中没有这个 <code>Category</code>，那么在不同版本之间切换时可能会导致崩溃或未定义行为。</li>
<li><strong>动态加载</strong>：Objective-C 支持动态加载类和 <code>Category</code>。如果 <code>Category</code> 能够添加成员变量，那么动态加载一个新的 <code>Category</code> 时，需要重新分配和调整现有对象的内存，这在设计和实现上是非常困难的。</li>
</ol>
<h3 id="苹果为什么这么设计"><a href="#苹果为什么这么设计" class="headerlink" title="苹果为什么这么设计"></a>苹果为什么这么设计</h3><p>苹果设计 <code>Category</code> 的目的是为了提供一种灵活且轻量级的方式来扩展类的功能，而不改变类的基本结构。这样设计的主要原因包括：</p>
<ol>
<li><strong>简化实现</strong>：不允许 <code>Category</code> 添加成员变量使得内存管理和对象模型的实现更加简单和可靠。</li>
<li><strong>动态特性</strong>：Objective-C 是一种动态语言，<code>Category</code> 提供了在运行时扩展类功能的能力，而无需重新编译类文件。这种灵活性是Objective-C的一个重要特性。</li>
<li><strong>稳定性和兼容性</strong>：通过限制 <code>Category</code> 的能力，可以确保类的内存布局在整个应用程序生命周期内保持稳定，从而提高程序的稳定性和兼容性。</li>
</ol>
<h3 id="如何在-Category-中添加属性"><a href="#如何在-Category-中添加属性" class="headerlink" title="如何在 Category 中添加属性"></a>如何在 <code>Category</code> 中添加属性</h3><p>虽然 <code>Category</code> 不能直接添加成员变量，但可以通过关联对象（Associated Objects）来间接实现属性的添加。</p>
<h4 id="1-使用关联对象"><a href="#1-使用关联对象" class="headerlink" title="1. 使用关联对象"></a>1. 使用关联对象</h4><p>你可以使用 <code>objc_setAssociatedObject</code> 和 <code>objc_getAssociatedObject</code> 函数来为 <code>Category</code> 添加属性。</p>
<figure class="highlight objc hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#import <span class="hljs-meta-string">&lt;objc/runtime.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">MyClass</span> (<span class="hljs-title">CategoryName</span>)</span></span><br><span class="line"><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-keyword">id</span> property;</span><br><span class="line"><span class="hljs-keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">MyClass</span> (<span class="hljs-title">CategoryName</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="hljs-keyword">void</span>)setProperty:(<span class="hljs-keyword">id</span>)value &#123;</span><br><span class="line">    objc_setAssociatedObject(<span class="hljs-keyword">self</span>, <span class="hljs-keyword">@selector</span>(property), value, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="hljs-keyword">id</span>)property &#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> objc_getAssociatedObject(<span class="hljs-keyword">self</span>, <span class="hljs-keyword">@selector</span>(property));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>在上面的代码中，我们使用了关联对象来为 <code>Category</code> 添加属性。<code>objc_setAssociatedObject</code> 函数将一个对象与一个键关联起来，而 <code>objc_getAssociatedObject</code> 函数则根据键获取关联的对象。</p>
<h4 id="2-关联对象策略"><a href="#2-关联对象策略" class="headerlink" title="2. 关联对象策略"></a>2. 关联对象策略</h4><p><code>objc_setAssociatedObject</code> 的第四个参数是一个关联策略，常见的策略包括：</p>
<ul>
<li><code>OBJC_ASSOCIATION_ASSIGN</code>：相当于 <code>assign</code> 属性。</li>
<li><code>OBJC_ASSOCIATION_RETAIN_NONATOMIC</code>：相当于 <code>strong</code> 非原子属性。</li>
<li><code>OBJC_ASSOCIATION_COPY_NONATOMIC</code>：相当于 <code>copy</code> 非原子属性。</li>
<li><code>OBJC_ASSOCIATION_RETAIN</code>：相当于 <code>strong</code> 原子属性。</li>
<li><code>OBJC_ASSOCIATION_COPY</code>：相当于 <code>copy</code> 原子属性。</li>
</ul>
<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p>虽然 <code>Category</code> 不能直接添加成员变量，但通过关联对象，我们可以间接地为 <code>Category</code> 添加属性。这种设计使得 <code>Category</code> 的实现更加简单和稳定，同时保留了扩展类功能的灵活性。苹果选择不允许 <code>Category</code> 添加成员变量，是为了简化内存管理、提高运行时性能和确保二进制兼容性。</p>
<p>7.为什么要设计元类？</p>
<p>8.SDK中有个类有私有成员变量，怎么改它的值？</p>
<p>9.数组的方法被hook了，怎么让有些数组不生效，使用系统的默认方法</p>

        </div>
        
        <div class="level is-size-7 is-uppercase">
            <div class="level-start">
                <div class="level-item">
                    <span class="is-size-6 has-text-grey has-mr-7">#</span>
                    <a class="has-link-grey -link" href="/tags/淡蓝网/">淡蓝网</a>, <a class="has-link-grey -link" href="/tags/面试/">面试</a>
                </div>
            </div>
        </div>
        
        
        
    </div>
</div>





<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/米可世界/">
                <span class="level-item">米可世界</span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>


</div>
                
                
            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo-2.png" alt="淡蓝网" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2024 SOSOWIKI&nbsp;
                All rights reserved.
                
                </p>
            </div>
            <div class="level-end">
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-CN");</script>

<script>
var IcarusThemeSettings = {
    article: {
        highlight: {
            clipboard: true,
            fold: 'unfolded'
        }
    }
};
</script>


    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>



    
    
    
    <script src="/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>

    
    

<a id="back-to-top" title="回到顶端" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>


    
    

    
    
    
    

    
    
    
    
    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="搜索公司、题目、关键字" />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '关于',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>